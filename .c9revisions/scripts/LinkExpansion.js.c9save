{"ts":1376757081001,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"$(function(){\n\n\tconfig = {\n\t\tapi_endpoint: 'http://api.longurl.org/v1/',\n\t\tworking_image: 'http://longurl.org/static/ajax_indicator_sm_round.gif'\n\t};\n\t\n\tknown_services = [];\n\tvar data_cache = [];\n\n\tgetServicesFromAPI = function() {\n\t\tjQuery.ajax({\n\t\t\ttype: 'GET',\n\t\t\turl: 'http://api.longurl.org/v1/services?format=json',\n\t\t\tdataType: 'json',\n\t\t\tsuccess: function(data) {\n\t\t\t\t\n\t\t\t\tif (typeof(data.messages) === 'undefined') {\n\t\t\t\t\tsaveKnownServices(data);\n\t\t\t\t\t//modifyShortLinks();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\t\n\tsaveKnownServices = function(data) {\n\t\t\n\t\tfor (var x in data) { // Foreach service\n\t\t\tif (typeof(data[x]) === 'object') {\n\t\t\t\tfor (var y in data[x]) { // Foreach domain\n\t\t\t\t\tif (typeof(data[x][y]) === 'string') {\n\t\t\t\t\t\tknown_services.push(data[x][y]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t}\n\t\t}\n\t\t\n\t\tknown_services = known_services.sort();\n\n\t\tcheckLinks();\n\t};\n\n\t//get all tiny urls\n\tgetServicesFromAPI();\n\t//get all urls from page\n\tallLinks = $('a');\n\n\tcheckLinks = function() {\n\t\tallLinks.each(function(){\n\t\tif($(this).attr('href')){\n\t\t\tvar hrefl=$(this).attr('href');\n\t\t\tif(checkShorturlDomains(hrefl)){\n\t\t\turl =Expandlink(hrefl);\n\t\t\t\n\t\t\t$(this).attr('href',url);\n\t\t\t$(this).text(url);\n\t\t\t}\n\t\t}}); \n\t}\n\n\t\n\tfunction checkShorturlDomains(href){\n\t\tfor(var j=0; j<known_services.length; j++){\n\t\t//if link matches with shorturldomain\n\t\tif(href.indexOf(known_services[j])!=-1){\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n}\n\nfunction Expandlink(url){\n\tvar longurl;\n\tvar apiURL = \"http://api.longurl.org/v2/expand?url=\"+ url + \"&format=json\";\n\t\n\t$.ajax({\n\turl: apiURL,\n\tdataType: \"json\",\n\tasync:false,\n\tsuccess: function(data){\n\t\t\n\t\tif(data[\"type\"]!=\"error\"){\n\t\tlongurl = data[\"long-url\"];\n\t\t}\n\t\telse{\n\t\t\tlongurl=url;\n\t\t}\n\t}\n\t});\n\treturn longurl;\n\t\n}\n\n});"]],"start1":0,"start2":0,"length1":0,"length2":1736}]],"length":1736}
