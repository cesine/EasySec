$(function(){
    var allLinks = $('a');
    
    var css = document.createElement("style");
    css.type = "text/css";
    css.innerHTML = ".easysec_safe { color: green; } .easysec_risk { color: orange; } ";
    document.body.appendChild(css);
    
    var checkUrl = function(url, score) {
        
        $.ajax({
            url: "http://api.mywot.com/0.4/public_link_json2?hosts='" + url + "'",
            dataType: "json",
            async:false,
            success: function(data) {
                var ret = "return";
                for(var i in data) {
                    for(var key in data[i].categories) {
                        if(key > 300) {
                            ret = "safe";
                        } else if(key > 200) {
                            ret = "risk";
                        } else {
                            ret = "bad";
                        }
                    }
                    break;
                }
                return ret;
            }
        });
    };
    
    allLinks.each(function() {
        if($(this).attr('href')) {
			var hrefl=$(this).attr('href');
            var category = checkUrl(hrefl);
			if(category == "bad") {
				$(this).attr('href',"#");
			} else if(category == "safe") {
    		    $(this).addClass("easysec_safe");
			} else {
    		    $(this).addClass("easysec_risk");
			}
        }
	});
});